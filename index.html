<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <title>Unicode to UTF-8</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <meta name="keywords" content=""/>
        <meta name="description" content="This is auto-generated by sublime-custom-insert"/>
        <meta name="revised" value="yinyong02,2017/11/23"/>
        <style type="text/css">
            html, body {
                padding: 0;
                margin: 0;
                background-color: #eee;
            }
            .row {
                margin: 5px;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            .source {
                border: 1px solid #ccc;
                font-size: 28px;
                outline: none;
                width: 200px;
                text-align: center;
            }
            .fixed {
                color: #3597CA;
            }
            .character {
                display: flex;
                justify-content: center;
                align-items: center;
                border: 1px solid #666;
                height: 100px;
                width: 400px;
                margin-top: 100px;
            }
        </style>
    </head>
    <body>
        <div id="app">
            <div class="row">
                <div class="character">
                    <span>请输入一个任意字符：</span>
                    <input class="source" v-model="key" type="text" maxlength="1" placeholder="1、a、中、👠" />
                </div>
            </div>
            <div class="row" v-if="key">
                "{{key}}" 的 Unicode 码的十六进制为 <span>0x{{code | hex | leftpad(4)}}</span>，二进制也就是 <span>b{{code | binary | leftpad(16)}}</span>
            </div>
            <div class="row" v-if="isOneByte">
                它只需要一个字节即可，Unicode 码也就是 UTF-8：<span class="fixed">0</span>{{code | binary | leftpad(7)}}
            </div>
            <div class="row" v-if="isTwoBytes">
                它需要两个字节，按照 <b>110xxxxx 10xxxxxx</b>格式填充：
                <span class="fixed">110</span>{{ (code>>6) | binary | leftpad(5)}} <span class="fixed">10</span>{{ (code & 0b111111) | binary | leftpad(6) }}
            </div>
            <div class="row" v-if="isThreeBytes">
                它需要三个字节，按照 <b>1110xxxx 10xxxxxx 10xxxxxx</b>格式填充：
                 <span class="fixed">1110</span>{{ (code>>12) | binary | leftpad(4)}} <span class="fixed">10</span>{{ ((code >> 6) & 0b111111) | binary | leftpad(6) }} <span class="fixed">10</span>{{ (code & 0b111111) | binary | leftpad(6) }}
            </div>
            <div class="row" v-if="isFourBytes">
                它需四个字节，按照 <b>11110xxx 10xxxxxx 10xxxxxx 10xxxxxx</b>格式填充：
                <span class="fixed">11110</span>{{ ((code >> 18) & 0b111) | binary | leftpad(3) }} <span class="fixed">10</span>{{ ((code >> 12) & 0b111111) | binary | leftpad(6) }} <span class="fixed">10</span>{{ ((code >> 6) & 0b111111) | binary | leftpad(6) }} <span class="fixed">10</span>{{(code  & 0b111111) | binary | leftpad(6)}}
            </div>
            <div class="row" v-if="key">
                转换为十六进制，"{{key}}" 的 UTF-8 也就是 U+{{utf8 | hex | leftpad(4)}}。
            </div>
        </div>
    </body>
    <script src="./vue.min.js"></script>
    <script>
        new Vue({
            el: '#app',
            data: {
                key: ''
            },
            filters: {
                leftpad(str, width, char) {
                    char = char || '0';
                    str = str.toString();
                    while (str.length < width)
                        str = char + str;
                    return str;
                },
                binary(code) {
                    return ('number' === typeof code) && code.toString(2);
                },
                hex(code) {
                    return ('number' === typeof code) && code.toString(16);
                }
            },
            computed: {
                code() {
                    return this.key.charCodeAt(0);
                },
                utf8() {
                    switch(true) {
                        case this.isOneByte:
                            return this.code;
                            break;
                        case this.isTwoBytes:
                            return ((((this.code >> 6) & 0b11111) | 0b11000000) << 8) | ((this.code & 0b111111) | 0b10000000)
                        case this.isThreeBytes:
                            return ((((this.code >> 12) & 0b1111) | 0b11100000) << 16)
                            | ((((this.code >> 6) & 0b111111) | 0b10000000) << 8)
                            | ((this.code & 0b111111) | 0b10000000)
                        case this.isFourBytes:
                            return ((((this.code >> 18) & 0b111) | 0b11110000) << 24)
                            | ((((this.code >> 12) & 0b111111) | 0b10000000) << 16)
                            | ((((this.code >> 6) & 0b111111) | 0b10000000) << 8)
                            | ((this.code & 0b111111) | 0b10000000);
                    }
                },
                isOneByte() {
                    return this.code <= 0x007F;
                },
                isTwoBytes() {
                    return this.code >= 0x0080 && this.code <= 0x07FF;
                },
                isThreeBytes() {
                    return this.code >= 0x0800 && this.code <= 0xFFFF;
                },
                isFourBytes() {
                    return this.code >= 0x10000 && this.code <= 0x10FFFF;
                }
            }
        });
    </script>
</html>
